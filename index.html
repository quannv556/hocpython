<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học Python từ Cơ bản đến Nâng cao</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; margin: 0; }
        .locked { filter: grayscale(1); opacity: 0.5; pointer-events: none; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 0.75rem; overflow: hidden; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .active-lesson { border: 2px solid #6366f1; background-color: #f5f3ff; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        #lesson-list::-webkit-scrollbar { width: 5px; }
        #lesson-list::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        #login-overlay {
            position: fixed; inset: 0; background: #0f172a; z-index: 9999;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .hidden { display: none !important; }
        
        .btn-login {
            background-color: #818cf8; color: #000; font-weight: 700;
            padding: 0.75rem; border-radius: 0.75rem; width: 100%;
            transition: all 0.2s ease; cursor: pointer;
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="login-overlay">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-slate-900">Đăng nhập lớp học</h2>
                <p class="text-slate-500 text-sm mt-1">Nhập thông tin tài khoản được cấp</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="login-name" class="w-full p-3 rounded-xl border border-slate-300 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Tên đăng nhập">
                <input type="email" id="login-email" class="w-full p-3 rounded-xl border border-slate-300 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Email học viên">
                <input type="password" id="login-pass" class="w-full p-3 rounded-xl border border-slate-300 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Mật khẩu">
                <button onclick="handleManualLogin()" class="btn-login shadow-lg">Đăng nhập</button>
                <div class="text-center">
                    <a href="https://docs.google.com/forms/d/YOUR_FORM_ID/viewform" target="_blank" class="text-sm text-indigo-600 hover:underline">Quên mật khẩu?</a>
                </div>
            </div>
            <p id="login-error" class="text-red-500 text-xs text-center mt-4 hidden font-bold">Sai thông tin đăng nhập!</p>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <header class="bg-slate-900 text-white py-4 px-6 flex justify-between items-center sticky top-0 z-50">
            <h1 class="text-lg font-bold flex items-center gap-2">
                <i data-lucide="terminal" class="text-indigo-400"></i> Python Master
            </h1>
            <div class="flex items-center gap-4 text-right">
                <div class="flex flex-col border-r border-slate-700 pr-4">
                    <span id="display-user-name" class="text-sm font-bold text-indigo-400"></span>
                    <button onclick="handleLogout()" class="text-[10px] text-red-400 hover:underline">Đăng xuất</button>
                </div>
                <div class="hidden sm:block">
                    <p class="text-[10px] text-slate-400 uppercase">Tiến độ: <span id="progress-text">1/20</span></p>
                    <div class="w-24 bg-slate-700 rounded-full h-1.5 mt-1">
                        <div id="progress-bar" class="bg-indigo-500 h-1.5 rounded-full" style="width: 5%"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-6 flex flex-col lg:flex-row gap-6">
            <div class="lg:w-2/3">
                <div class="bg-white p-4 rounded-xl shadow-md border border-slate-200">
                    <div class="video-container mb-4">
                        <iframe id="main-video" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                    </div>
                    <h2 id="current-lesson-title" class="text-xl font-bold text-slate-900 mb-1 underline decoration-indigo-500 underline-offset-8">Buổi học</h2>
                    <p id="current-lesson-desc" class="text-slate-500 text-sm mb-6"></p>
                    
                    <div class="flex flex-col sm:flex-row gap-3 border-t pt-4">
                        <button id="complete-btn" onclick="completeLesson()" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2">
                            <i data-lucide="check-circle"></i> Hoàn thành & Sang bài tiếp theo
                        </button>
                        <button onclick="resetProgress()" class="px-4 py-2 text-slate-400 text-xs hover:text-red-500">Xóa tiến độ</button>
                    </div>
                </div>
            </div>

            <div class="lg:w-1/3">
                <div class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
                    <div class="p-4 bg-slate-50 border-b font-bold text-xs uppercase tracking-widest text-slate-500 flex justify-between">
                        <span>Lộ trình bài học</span>
                        <i data-lucide="list-video" class="w-4 h-4 text-indigo-600"></i>
                    </div>
                    <div id="lesson-list" class="max-h-[550px] overflow-y-auto p-2 space-y-2 text-sm"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const VALID_USERS = [
            { name: "A", email: "nva@gmail.com", pass: "123" },
            { name: "Admin", email: "admin@gmail.com", pass: "admin123" }
        ];

        const lessons = [
            { id: 1, title: "Buổi 1: Cài đặt Python", videoId: "1PXp-ZMJifDgK49HEcRtmi0eboiEeTr6O", desc: "Hướng dẫn cài đặt môi trường lập trình." },
            { id: 2, title: "Buổi 2: Biến dữ liệu", videoId: "ID_2", desc: "Cách khai báo biến và các kiểu dữ liệu." },
            { id: 3, title: "Buổi 3: Logic If-Else", videoId: "ID_3", desc: "Xử lý điều kiện logic." },
            { id: 4, title: "Buổi 4: Vòng lặp For", videoId: "ID_4", desc: "Tự động hóa với vòng lặp." },
            { id: 5, title: "Buổi 5: List & Tuple", videoId: "ID_5", desc: "Quản lý mảng dữ liệu danh sách." },
            { id: 6, title: "Buổi 6: Dictionary", videoId: "ID_6", desc: "Cấu trúc dữ liệu Key-Value." },
            { id: 7, title: "Buổi 7: Hàm Function", videoId: "ID_7", desc: "Viết mã nguồn tái sử dụng." },
            { id: 8, title: "Buổi 8: Modules", videoId: "ID_8", desc: "Sử dụng thư viện hỗ trợ." },
            { id: 9, title: "Buổi 9: Xử lý chuỗi", videoId: "ID_9", desc: "Thao tác cắt ghép văn bản." },
            { id: 10, title: "Buổi 10: Đọc ghi File", videoId: "ID_10", desc: "Làm việc với file hệ thống." },
            { id: 11, title: "Buổi 11: Try-Except", videoId: "ID_11", desc: "Bắt lỗi chương trình." },
            { id: 12, title: "Buổi 12: OOP P1", videoId: "ID_12", desc: "Hướng đối tượng cơ bản." },
            { id: 13, title: "Buổi 13: OOP P2", videoId: "ID_13", desc: "Hướng đối tượng nâng cao." },
            { id: 14, title: "Buổi 14: Numpy", videoId: "ID_14", desc: "Tính toán số học hiệu năng cao." },
            { id: 15, title: "Buổi 15: Pandas P1", videoId: "ID_15", desc: "Xử lý bảng dữ liệu Pandas." },
            { id: 16, title: "Buổi 16: Pandas P2", videoId: "ID_16", desc: "Phân tích dữ liệu thực tế." },
            { id: 17, title: "Buổi 17: Biểu đồ", videoId: "ID_17", desc: "Vẽ đồ thị Matplotlib." },
            { id: 18, title: "Buổi 18: Web Scraping", videoId: "ID_18", desc: "Lấy dữ liệu từ Web." },
            { id: 19, title: "Buổi 19: Automation", videoId: "ID_19", desc: "Tự động hóa tác vụ văn phòng." },
            { id: 20, title: "Buổi 20: Project", videoId: "ID_20", desc: "Hoàn thiện đồ án cuối khóa." }
        ];

        let currentUnlocked = 1;
        let activeLessonId = 1;

        // Hàm hiển thị giao diện không cần load lại trang
        function showMainContent(userName) {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('display-user-name').innerText = userName;
            
            // Khôi phục tiến độ nếu có trong bộ nhớ
            const saved = localStorage.getItem('python_progress');
            if (saved) currentUnlocked = parseInt(saved);
            
            renderLessons();
            loadVideo(1); // Mặc định mở bài 1
        }

        function handleManualLogin() {
            const n = document.getElementById('login-name').value;
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-pass').value;
            
            const user = VALID_USERS.find(u => u.name === n && u.email === e && u.pass === p);
            
            if (user) {
                // Lưu trạng thái đăng nhập vào bộ nhớ trình duyệt
                localStorage.setItem('logged_name', user.name);
                showMainContent(user.name);
            } else {
                const err = document.getElementById('login-error');
                err.classList.remove('hidden');
                setTimeout(() => err.classList.add('hidden'), 3000);
            }
        }

        function renderLessons() {
            const container = document.getElementById('lesson-list');
            container.innerHTML = '';
            lessons.forEach(l => {
                const isLocked = l.id > currentUnlocked;
                const isActive = l.id === activeLessonId;
                const div = document.createElement('div');
                div.className = `p-3 rounded-xl border flex items-center gap-3 transition-all cursor-pointer ${isLocked ? 'locked border-slate-100' : isActive ? 'active-lesson' : 'bg-white border-slate-200 hover:border-indigo-300'}`;
                div.onclick = () => !isLocked && loadVideo(l.id);
                div.innerHTML = `
                    <div class="w-7 h-7 rounded-lg flex items-center justify-center font-bold text-[11px] ${isLocked ? 'bg-slate-200 text-slate-400' : 'bg-indigo-600 text-white shadow-sm'}">
                        ${isLocked ? '<i data-lucide="lock" class="w-3 h-3"></i>' : l.id}
                    </div>
                    <div class="flex-1 font-bold ${isActive ? 'text-indigo-700' : 'text-slate-700'}">${l.title}</div>
                    ${l.id < currentUnlocked ? '<i data-lucide="check" class="text-emerald-500 w-4 h-4"></i>' : ''}
                `;
                container.appendChild(div);
            });
            updateHeaderProgress();
            lucide.createIcons();
        }

        function loadVideo(id) {
            activeLessonId = id;
            const lesson = lessons.find(l => l.id === id);
            document.getElementById('main-video').src = `https://drive.google.com/file/d/${lesson.videoId}/preview`;
            document.getElementById('current-lesson-title').innerText = lesson.title;
            document.getElementById('current-lesson-desc').innerText = lesson.desc;
            renderLessons();
        }

        function completeLesson() {
            const nextId = activeLessonId + 1;
            if (activeLessonId === currentUnlocked && currentUnlocked < 20) {
                currentUnlocked++;
                localStorage.setItem('python_progress', currentUnlocked); // Lưu tiến độ ngay lập tức
            }
            if (nextId <= 20) loadVideo(nextId);
        }

        function updateHeaderProgress() {
            const percent = ((currentUnlocked - 1) / 20) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-text').innerText = `${currentUnlocked}/20`;
        }

        function handleLogout() {
            localStorage.removeItem('logged_name');
            // Quay về màn hình đăng nhập bằng cách ẩn/hiện thay vì reload
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('login-overlay').classList.remove('hidden');
        }

        function resetProgress() {
            if(confirm("Làm mới lộ trình học?")) {
                localStorage.removeItem('python_progress');
                currentUnlocked = 1;
                loadVideo(1);
            }
        }

        // --- KHỐI MÃ QUAN TRỌNG ĐỂ KHÔNG BỊ THOÁT KHI F5 ---
        window.onload = function() {
            const savedName = localStorage.getItem('logged_name');
            if (savedName) {
                showMainContent(savedName);
            }
            lucide.createIcons();
        };
    </script>
</body>

</html>
